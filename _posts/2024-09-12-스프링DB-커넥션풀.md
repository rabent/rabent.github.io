---
title: "스프링 DB-커넥션 풀"
layout: post
date: 2024-09-12 16:27
tag:
- Spring
- JAVA
description: 스프링 입문 강의 핵심 정리
---  

# 커넥션 풀  

![DB 커넥션](/assets/img/DB%20커넥션.png)  

위 그림과 같이 DB와 커넥션을 생성하는 것은 상당히 복잡한 과정이 필요하다. 정확한 과정은 다음과 같다.  

1. 애플리케이션 로직은 DB 드라이버를 통해 커넥션을 조회한다.  
2. DB 드라이버는 DB와 TCP/IP 커넥션을 연결한다. 물론 이 과정에서 3 way handshake 같은 TCP/IP 연결을 위한 네트워크 동작이 발생한다.  
3. DB 드라이버는 TCP/IP 커넥션이 연결되면 ID, PW와 기타 부가정보를 DB에 전달한다.  
4. DB는 ID, PW를 통해 내부 인증을 완료하고, 내부에 DB 세션을 생성한다.
5. DB는 커넥션 생성이 완료되었다는 응답을 보낸다.  
6. DB 드라이버는 커넥션 객체를 생성해서 클라이언트에 반환한다.  

따라서 커넥션을 새로 생성하는 것은 리소스를 매번 소모할 뿐만 아니라, 응답 시간도 상당히 소요되기 때문에 고객에게 좋지 않은 사용경험을 줄 수 있다.  

이러한 문제를 해결하기 위해 나온 것이 **커넥션 풀**이다.  

![커넥션풀1](/assets/img/커넥션풀1.png)  

커넥션 풀은 어플리케이션이 시작하는 시점에 커넥션을 필요한만큼 미리 확보한 후 풀에 저장하여 관리한다.  

![커넥션풀2](/assets/img/커넥션풀2.png)  

커넥션 풀에 저장된 커넥션들은 TCP/IP로 DB와 계속해서 연결되어있는 상태이기에 언제든 SQL을 DB로 전송할 수 있다.  

![커넥션풀3](/assets/img/커넥션풀3.png)  

커넥션 풀을 사용하면 이전과 같이 DriverManager를 통해 커넥션을 생성하지 않는다. 대신 커넥션 풀에서 이미 연결되어 있는 커넥션을 객체 참조로 가져다 쓰면 된다.  
커넥션 풀에 커넥션을 요청하면 풀에서 가지고 있는 대기 커넥션 중 하나를 반환한다.  

![커넥션풀4](/assets/img/커넥션풀4.png)  

커넥션 풀에서 받아온 커넥션의 사용이 종료되면 연결을 종료하는 대신 커넥션 풀에 반환한다.  

이러한 커넥션 풀은 다양한 이점이 있기에 실무에선 기본으로 사용하고, 직접 구현할 수도 있지만 편리하고 성능이 뛰어난 오픈소스가 여러 가지 있기에 보통 오픈소스를 사용한다.  
오픈 소스엔 여러 가지가 있지만 **HikariCP**가 성능 및 편리함 면에서 우위에 있으므로 보통은 HikariCP를 사용한다. 스프링 부트 2.0에서도 기본 커넥션 풀로 사용한다.  

